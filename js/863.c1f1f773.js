(self["webpackChunkpvp"]=self["webpackChunkpvp"]||[]).push([[863],{37007:function(e,t,n){const{default_avatar:o,__sourceType:i,__postType:s,__wikiType:r,__appType:a,__gameType:l,__imgPath:c,__iconPath:u,__clients:m,__ossMirror:p}=n(58663),d=n(5157),h=n(77503);e.exports={resolveImagePath:function(e){return e&&e.length?(e=e.replace(/oss\.jx3box\.com/g,"cdn.jx3box.com"),e=e.replace(/http:/g,"https:"),e):""},checkImageLoad:function(e){e.length&&e.one("error",(function(){var e=$(this).attr("src"),t=e.replace(/cdn\.jx3box\.com/g,"oss.jx3box.com");$(this).attr("src",t)}))},showAvatar:function(e,t="s",n=!0){let i="";i=e?e.replace(/http:/g,"https:"):o;const s={s:"?x-oss-process=style/avatar_s",m:"?x-oss-process=style/avatar_m",l:"?x-oss-process=style/avatar_l"};if(s[t])i+=s[t];else{let e=`?x-oss-process=image/auto-orient,1/resize,m_fill,w_${t},h_${t}/quality,Q_100`;i+=e}return n&&(i=i.replace(/oss\.jx3box\.com/g,"cdn.jx3box.com")),i},showBanner:function(e,t="mini_banner",n=!0){return e?(e=e.replace(/http:/g,"https:"),n&&(e=e.replace(/oss\.jx3box\.com/g,"cdn.jx3box.com")),e+=`?x-oss-process=style/${t}`,e):""},getThumbnail:function(e,t=88,n=!0){return e?(e=e.replace(/http:/g,"https:"),n&&(e=e.replace(/oss\.jx3box\.com/g,"cdn.jx3box.com")),Array.isArray(t)?e+=`?x-oss-process=image/auto-orient,1/resize,m_fill,w_${t[0]},h_${t[1]}/quality,Q_100`:isNaN(t)?e+=`?x-oss-process=style/${t}`:e+=`?x-oss-process=image/auto-orient,1/resize,m_fill,w_${t},h_${t}/quality,Q_100`,e):""},iconLink(e,t="std"){if(!e||isNaN(parseInt(e))||-1==e)return`${c}image/common/nullicon.png`;{let n="origin"==t?"origin_icon":"icon";return`${u}${n}/${e}.png`}},getAppIcon(e,t=!1){return c+(t?"image/box-colorful/":"image/box/")+e+".svg"},editLink:function(e,t){return"/publish/#/"+e+"/"+t},publishLink:function(e){return"/publish/#/"+e},postLink:function(e,t){return"/"+e+"/"+t},getLink:function(e,t,n){if(t=t||"",i.cms_types.includes(e)||i.pvx_types.includes(e))return"/"+e+"/"+t;if(i.wiki_types.includes(e))return"item_plan"===e?"/item/plan_view/"+t:("achievement"===e&&(e="cj"),"wiki"===e&&(e="knowledge"),`/${e}/view/${t}`);if(i.app_types.includes(e))return`/${e}/view/${t}`;if(i.db_types.includes(e)){let o=`/app/database/?type=${e}&query=${t}`;return n&&(o+=`&level=${n}`),o}if(i.dbm_types.includes(e))return`/dbm/${e}/${t}`;if(i.team_types.includes(e))return"/team/"+e+"/"+t;if("rank"==e){let e=t,o=n,i="";return i=t>6?`/jdt/${t}th/rank`:"/rank/race/#/"+e,o&&(i+=`?aid=${o}`),i}return i.exam_types.includes(e)?"/exam/"+e+"/"+t:i.vip_types.includes(e)?"/vip/"+e+"/"+t:e&&t?"/"+e+"/"+t:"/"},authorLink:function(e){return"/author/"+e},tvLink:function(e,t){return d[e]+t},getRewrite:function(e){let t="",n=new URLSearchParams(location.search),o=!n.get(e);if(o){let e=location.pathname.slice(1).split("/");t=e[1]}else t=n.get(e);return t},getPID:function(){let e=new URLSearchParams(location.search),t=e.get("pid");return t&&!isNaN(t)?t:0},getAppID:function(){let e=location.pathname.slice(1).split("/");return e.length&&!isNaN(e[1])?e[1]:0},getAppType:function(){return location.pathname.slice(1).split("/")[0]},getQuery:function(e){let t=new URLSearchParams(location.search);return t.get(e)},getTypeLabel:function(e){let t=Object.assign({},s,r,a,l);return t[e]||"未知"},buildTarget:function(e=1025){return window.innerWidth<e?"_self":"_blank"},ts2str(e,t={polished:!0,separator:"-"}){let n=new Date(1e3*parseInt(e)),o=n.getFullYear(),i=n.getMonth()+1,s=n.getDate(),r=t.polished?`${o}${t.separator}${a(i)}${t.separator}${a(s)}`:`${o}${t.separator}${i}${t.separator}${s}`;return r;function a(e){return e<10?"0"+e:e}},jx3ClientType(){return location.hostname.includes("origin")?2:1},extractTextContent(e){if(!e||"string"!==typeof e)return[];let t=[];const n=e.replace(/<Text>(.*?)<\/text>/gimsy,"<span $1></span>");let o=h.load(`<div>${n}</div>`),i=o("span");if(!i.length)return[];for(let s of i)t.push(Object.assign({},s.attribs));return t},showSchoolIcon(e){return c+"image/school/"+e+".png"},showForceIcon(e){return c+"image/force/"+e+".png"},showMountIcon(e){return c+"image/xf/"+e+".png"},showClientLabel(e){return m[e]},getMedalLink(e,t){return`/rank/race/#/${e}/${t}`},convertUrlToProtocol(e){const t=/https?:\/\/([^/.]+)\.jx3box\.com\/(.*)/,n=e.match(t);if(n){const e=n[1],t=n[2],o=`${e}:/${t}`;return o}return e}}},15442:function(e,t,n){e.exports=n(54778)},66887:function(e,t,n){"use strict";var o=n(97969),i=n(19688),s=n(96046),r=n(77448),a=n(27109),l=n(83608),c=n(90140),u=n(92407);e.exports=function(e){return new Promise((function(t,n){var m=e.data,p=e.headers;o.isFormData(m)&&delete p["Content-Type"],(o.isBlob(m)||o.isFile(m))&&m.type&&delete p["Content-Type"];var d=new XMLHttpRequest;if(e.auth){var h=e.auth.username||"",f=unescape(encodeURIComponent(e.auth.password))||"";p.Authorization="Basic "+btoa(h+":"+f)}var g=a(e.baseURL,e.url);if(d.open(e.method.toUpperCase(),r(g,e.params,e.paramsSerializer),!0),d.timeout=e.timeout,d.onreadystatechange=function(){if(d&&4===d.readyState&&(0!==d.status||d.responseURL&&0===d.responseURL.indexOf("file:"))){var o="getAllResponseHeaders"in d?l(d.getAllResponseHeaders()):null,s=e.responseType&&"text"!==e.responseType?d.response:d.responseText,r={data:s,status:d.status,statusText:d.statusText,headers:o,config:e,request:d};i(t,n,r),d=null}},d.onabort=function(){d&&(n(u("Request aborted",e,"ECONNABORTED",d)),d=null)},d.onerror=function(){n(u("Network Error",e,null,d)),d=null},d.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(u(t,e,"ECONNABORTED",d)),d=null},o.isStandardBrowserEnv()){var w=(e.withCredentials||c(g))&&e.xsrfCookieName?s.read(e.xsrfCookieName):void 0;w&&(p[e.xsrfHeaderName]=w)}if("setRequestHeader"in d&&o.forEach(p,(function(e,t){"undefined"===typeof m&&"content-type"===t.toLowerCase()?delete p[t]:d.setRequestHeader(t,e)})),o.isUndefined(e.withCredentials)||(d.withCredentials=!!e.withCredentials),e.responseType)try{d.responseType=e.responseType}catch(y){if("json"!==e.responseType)throw y}"function"===typeof e.onDownloadProgress&&d.addEventListener("progress",e.onDownloadProgress),"function"===typeof e.onUploadProgress&&d.upload&&d.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){d&&(d.abort(),n(e),d=null)})),m||(m=null),d.send(m)}))}},54778:function(e,t,n){"use strict";var o=n(97969),i=n(39787),s=n(89356),r=n(73916),a=n(2921);function l(e){var t=new s(e),n=i(s.prototype.request,t);return o.extend(n,s.prototype,t),o.extend(n,t),n}var c=l(a);c.Axios=s,c.create=function(e){return l(r(c.defaults,e))},c.Cancel=n(43696),c.CancelToken=n(12893),c.isCancel=n(82022),c.all=function(e){return Promise.all(e)},c.spread=n(10871),e.exports=c,e.exports["default"]=c},43696:function(e){"use strict";function t(e){this.message=e}t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,e.exports=t},12893:function(e,t,n){"use strict";var o=n(43696);function i(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new o(e),t(n.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.source=function(){var e,t=new i((function(t){e=t}));return{token:t,cancel:e}},e.exports=i},82022:function(e){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},89356:function(e,t,n){"use strict";var o=n(97969),i=n(77448),s=n(44576),r=n(24447),a=n(73916);function l(e){this.defaults=e,this.interceptors={request:new s,response:new s}}l.prototype.request=function(e){"string"===typeof e?(e=arguments[1]||{},e.url=arguments[0]):e=e||{},e=a(this.defaults,e),e.method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=[r,void 0],n=Promise.resolve(e);this.interceptors.request.forEach((function(e){t.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){t.push(e.fulfilled,e.rejected)}));while(t.length)n=n.then(t.shift(),t.shift());return n},l.prototype.getUri=function(e){return e=a(this.defaults,e),i(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},o.forEach(["delete","get","head","options"],(function(e){l.prototype[e]=function(t,n){return this.request(a(n||{},{method:e,url:t}))}})),o.forEach(["post","put","patch"],(function(e){l.prototype[e]=function(t,n,o){return this.request(a(o||{},{method:e,url:t,data:n}))}})),e.exports=l},44576:function(e,t,n){"use strict";var o=n(97969);function i(){this.handlers=[]}i.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},i.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},i.prototype.forEach=function(e){o.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=i},27109:function(e,t,n){"use strict";var o=n(88086),i=n(78111);e.exports=function(e,t){return e&&!o(t)?i(e,t):t}},92407:function(e,t,n){"use strict";var o=n(4784);e.exports=function(e,t,n,i,s){var r=new Error(e);return o(r,t,n,i,s)}},24447:function(e,t,n){"use strict";var o=n(97969),i=n(61823),s=n(82022),r=n(2921);function a(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){a(e),e.headers=e.headers||{},e.data=i(e.data,e.headers,e.transformRequest),e.headers=o.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),o.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]}));var t=e.adapter||r.adapter;return t(e).then((function(t){return a(e),t.data=i(t.data,t.headers,e.transformResponse),t}),(function(t){return s(t)||(a(e),t&&t.response&&(t.response.data=i(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},4784:function(e){"use strict";e.exports=function(e,t,n,o,i){return e.config=t,n&&(e.code=n),e.request=o,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},73916:function(e,t,n){"use strict";var o=n(97969);e.exports=function(e,t){t=t||{};var n={},i=["url","method","data"],s=["headers","auth","proxy","params"],r=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],a=["validateStatus"];function l(e,t){return o.isPlainObject(e)&&o.isPlainObject(t)?o.merge(e,t):o.isPlainObject(t)?o.merge({},t):o.isArray(t)?t.slice():t}function c(i){o.isUndefined(t[i])?o.isUndefined(e[i])||(n[i]=l(void 0,e[i])):n[i]=l(e[i],t[i])}o.forEach(i,(function(e){o.isUndefined(t[e])||(n[e]=l(void 0,t[e]))})),o.forEach(s,c),o.forEach(r,(function(i){o.isUndefined(t[i])?o.isUndefined(e[i])||(n[i]=l(void 0,e[i])):n[i]=l(void 0,t[i])})),o.forEach(a,(function(o){o in t?n[o]=l(e[o],t[o]):o in e&&(n[o]=l(void 0,e[o]))}));var u=i.concat(s).concat(r).concat(a),m=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===u.indexOf(e)}));return o.forEach(m,c),n}},19688:function(e,t,n){"use strict";var o=n(92407);e.exports=function(e,t,n){var i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(o("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},61823:function(e,t,n){"use strict";var o=n(97969);e.exports=function(e,t,n){return o.forEach(n,(function(n){e=n(e,t)})),e}},2921:function(e,t,n){"use strict";var o=n(97969),i=n(28013),s={"Content-Type":"application/x-www-form-urlencoded"};function r(e,t){!o.isUndefined(e)&&o.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}function a(){var e;return("undefined"!==typeof XMLHttpRequest||"undefined"!==typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(e=n(66887)),e}var l={adapter:a(),transformRequest:[function(e,t){return i(t,"Accept"),i(t,"Content-Type"),o.isFormData(e)||o.isArrayBuffer(e)||o.isBuffer(e)||o.isStream(e)||o.isFile(e)||o.isBlob(e)?e:o.isArrayBufferView(e)?e.buffer:o.isURLSearchParams(e)?(r(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):o.isObject(e)?(r(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"===typeof e)try{e=JSON.parse(e)}catch(t){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};o.forEach(["delete","get","head"],(function(e){l.headers[e]={}})),o.forEach(["post","put","patch"],(function(e){l.headers[e]=o.merge(s)})),e.exports=l},39787:function(e){"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),o=0;o<n.length;o++)n[o]=arguments[o];return e.apply(t,n)}}},77448:function(e,t,n){"use strict";var o=n(97969);function i(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var s;if(n)s=n(t);else if(o.isURLSearchParams(t))s=t.toString();else{var r=[];o.forEach(t,(function(e,t){null!==e&&"undefined"!==typeof e&&(o.isArray(e)?t+="[]":e=[e],o.forEach(e,(function(e){o.isDate(e)?e=e.toISOString():o.isObject(e)&&(e=JSON.stringify(e)),r.push(i(t)+"="+i(e))})))})),s=r.join("&")}if(s){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}},78111:function(e){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},96046:function(e,t,n){"use strict";var o=n(97969);e.exports=o.isStandardBrowserEnv()?function(){return{write:function(e,t,n,i,s,r){var a=[];a.push(e+"="+encodeURIComponent(t)),o.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),o.isString(i)&&a.push("path="+i),o.isString(s)&&a.push("domain="+s),!0===r&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}()},88086:function(e){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},90140:function(e,t,n){"use strict";var o=n(97969);e.exports=o.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(e){var o=e;return t&&(n.setAttribute("href",o),o=n.href),n.setAttribute("href",o),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=i(window.location.href),function(t){var n=o.isString(t)?i(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return function(){return!0}}()},28013:function(e,t,n){"use strict";var o=n(97969);e.exports=function(e,t){o.forEach(e,(function(n,o){o!==t&&o.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[o])}))}},83608:function(e,t,n){"use strict";var o=n(97969),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,s,r={};return e?(o.forEach(e.split("\n"),(function(e){if(s=e.indexOf(":"),t=o.trim(e.substr(0,s)).toLowerCase(),n=o.trim(e.substr(s+1)),t){if(r[t]&&i.indexOf(t)>=0)return;r[t]="set-cookie"===t?(r[t]?r[t]:[]).concat([n]):r[t]?r[t]+", "+n:n}})),r):r}},10871:function(e){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},97969:function(e,t,n){"use strict";var o=n(39787),i=Object.prototype.toString;function s(e){return"[object Array]"===i.call(e)}function r(e){return"undefined"===typeof e}function a(e){return null!==e&&!r(e)&&null!==e.constructor&&!r(e.constructor)&&"function"===typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function l(e){return"[object ArrayBuffer]"===i.call(e)}function c(e){return"undefined"!==typeof FormData&&e instanceof FormData}function u(e){var t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer,t}function m(e){return"string"===typeof e}function p(e){return"number"===typeof e}function d(e){return null!==e&&"object"===typeof e}function h(e){if("[object Object]"!==i.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function f(e){return"[object Date]"===i.call(e)}function g(e){return"[object File]"===i.call(e)}function w(e){return"[object Blob]"===i.call(e)}function y(e){return"[object Function]"===i.call(e)}function _(e){return d(e)&&y(e.pipe)}function k(e){return"undefined"!==typeof URLSearchParams&&e instanceof URLSearchParams}function b(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}function x(){return("undefined"===typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!==typeof window&&"undefined"!==typeof document)}function v(e,t){if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),s(e))for(var n=0,o=e.length;n<o;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}function C(){var e={};function t(t,n){h(e[n])&&h(t)?e[n]=C(e[n],t):h(t)?e[n]=C({},t):s(t)?e[n]=t.slice():e[n]=t}for(var n=0,o=arguments.length;n<o;n++)v(arguments[n],t);return e}function S(e,t,n){return v(t,(function(t,i){e[i]=n&&"function"===typeof t?o(t,n):t})),e}function L(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}e.exports={isArray:s,isArrayBuffer:l,isBuffer:a,isFormData:c,isArrayBufferView:u,isString:m,isNumber:p,isObject:d,isPlainObject:h,isUndefined:r,isDate:f,isFile:g,isBlob:w,isFunction:y,isStream:_,isURLSearchParams:k,isStandardBrowserEnv:x,forEach:v,merge:C,extend:S,trim:b,stripBOM:L}},18368:function(e,t,n){"use strict";n.d(t,{Z:function(){return yn}});var o=n(66252);const i={class:"c-comment-panel"},s={class:"u-order"},r=(0,o._)("span",{class:"u-label"},"排序模式：",-1),a={class:"u-op"},l={class:"c-comment-pages"},c={class:"u-pages"};function u(e,t,n,u,m,p){const d=(0,o.up)("CommentInputForm"),h=(0,o.up)("el-radio-button"),f=(0,o.up)("el-radio-group"),g=(0,o.up)("el-switch"),w=(0,o.up)("CommentAvatar"),y=(0,o.up)("CommentWithReply"),_=(0,o.up)("el-pagination"),k=(0,o.up)("el-main"),b=(0,o.up)("el-container"),x=(0,o.Q2)("loading");return(0,o.wy)(((0,o.wg)(),(0,o.j4)(b,{class:"c-comment"},{default:(0,o.w5)((()=>[(0,o.Wm)(k,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,{onSubmit:p.userSubmitInputForm},null,8,["onSubmit"]),(0,o._)("div",i,[(0,o._)("div",s,[r,(0,o.Wm)(f,{modelValue:e.isDesc,"onUpdate:modelValue":t[0]||(t[0]=t=>e.isDesc=t),onChange:p.changeOrder,size:"small"},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{label:"DESC"},{default:(0,o.w5)((()=>[(0,o.Uk)("最后靠前")])),_:1}),(0,o.Wm)(h,{label:"ASC"},{default:(0,o.w5)((()=>[(0,o.Uk)("最早靠前")])),_:1})])),_:1},8,["modelValue","onChange"])]),(0,o._)("div",a,[(0,o.Wm)(g,{class:"c-comment-panel-likes",modelValue:e.orderByLikes,"onUpdate:modelValue":t[1]||(t[1]=t=>e.orderByLikes=t),onChange:p.changeOrderByLikes,"active-text":"获赞靠前"},null,8,["modelValue","onChange"]),e.commentPower.is_author||e.commentPower.is_editor?((0,o.wg)(),(0,o.j4)(g,{key:0,class:"c-comment-panel-likes",modelValue:e.openWhiteList,"onUpdate:modelValue":t[2]||(t[2]=t=>e.openWhiteList=t),onChange:p.changeWhiteList,"active-text":"开启过滤",title:"开启过滤后，仅设为显示的评论可被其他人所见"},null,8,["modelValue","onChange"])):(0,o.kq)("",!0)])]),p.isNormal?((0,o.wg)(),(0,o.iD)(o.HY,{key:0},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.commentList,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.id,class:"c-comment-list"},[(0,o.Wm)(w,{"user-avatar":p.showAvatar(t.avatar),"user-href":p.profileLink(t.userId),username:t.displayName,avatarFrame:t.user_avatar_frame,withFrame:!0,avatarSize:48},null,8,["user-avatar","user-href","username","avatarFrame"]),(0,o.Wm)(y,{"base-api":e.baseAPI,item:t,category:n.category,power:e.commentPower,onDeleteComment:p.deleteComment,onSetTopComment:p.setTopComment,onSetStarComment:p.setStarComment,"user-href":p.profileLink(t.userId),username:t.displayName,onSetWhiteComment:p.setWhiteComment,onSetLikeComment:p.setLikeComment,onHide:p.hideComment},null,8,["base-api","item","category","power","onDeleteComment","onSetTopComment","onSetStarComment","user-href","username","onSetWhiteComment","onSetLikeComment","onHide"])])))),128)),(0,o._)("div",l,[e.commentList.length>5?((0,o.wg)(),(0,o.j4)(d,{key:0,onSubmit:p.userSubmitInputForm,isBottom:e.commentList.length>5},null,8,["onSubmit","isBottom"])):(0,o.kq)("",!0),(0,o._)("div",c,[(0,o.Wm)(_,{style:{"text-align":"right"},background:"","hide-on-single-page":"",onCurrentChange:p.handleCurrentChange,"current-page":e.pager.index,"page-size":e.pager.pageSize,layout:"prev, pager, next, total",total:e.pager.total},null,8,["onCurrentChange","current-page","page-size","total"])])])],64)):(0,o.kq)("",!0)])),_:1})])),_:1})),[[x,e.loading]])}var m=n(17233),p=n(3577);const d={class:"c-comment-avatar"},h=["href"],f=["src"];function g(e,t,n,i,s,r){const a=(0,o.up)("el-avatar"),l=(0,o.up)("el-link");return(0,o.wg)(),(0,o.iD)("div",d,[(0,o._)("a",{class:"u-avatar",href:n.userHref,target:"_blank"},[(0,o.Wm)(a,{class:(0,p.C_)(["u-avatar-pic",36==n.avatarSize?"xxs":""]),shape:"circle",size:n.avatarSize,src:n.userAvatar},null,8,["class","size","src"]),n.avatarFrame?((0,o.wg)(),(0,o.iD)("i",{key:0,class:(0,p.C_)(["u-avatar-frame",36==n.avatarSize?"xxs":"xs"])},[(0,o._)("img",{src:r.frameUrl},null,8,f)],2)):(0,o.kq)("",!0)],8,h),(0,o.Wm)(l,{class:"u-name",type:"primary",target:"_blank",href:n.userHref},{default:(0,o.w5)((()=>[(0,o.Uk)((0,p.zw)(n.username),1)])),_:1},8,["href"])])}var w=n(89847);const{__imgPath:y}=w;var _={name:"CommentAvatar",props:["avatarSize","userAvatar","userHref","username","avatarFrame","withFrame"],data:function(){return{}},computed:{frameUrl:function(){return y+`avatar/images/${this.avatarFrame}/${this.avatarFrame}.svg`}},methods:{},mounted:function(){}},k=n(83744);const b=(0,k.Z)(_,[["render",g]]);var x=b;const v={class:"c-comment-tools"},C={class:"c-comment-secret"},S={class:"u-toolbar"};function L(e,t,n,i,s,r){const a=(0,o.up)("el-input"),l=(0,o.up)("Picture"),c=(0,o.up)("el-icon"),u=(0,o.up)("Emotion"),m=(0,o.up)("quickReply"),p=(0,o.up)("InfoFilled"),d=(0,o.up)("el-tooltip"),h=(0,o.up)("el-checkbox"),f=(0,o.up)("Uploader"),g=(0,o.up)("el-button"),w=(0,o.up)("el-form-item"),y=(0,o.up)("el-form");return(0,o.wg)(),(0,o.j4)(y,{ref:"form",model:e.newComment,class:"c-comment-box"},{default:(0,o.w5)((()=>[(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Wm)(a,{rows:"3",type:"textarea",maxlength:"300","show-word-limit":"",modelValue:e.newComment.content,"onUpdate:modelValue":t[0]||(t[0]=t=>e.newComment.content=t),placeholder:"参与讨论...",id:e.inputId},null,8,["modelValue","id"]),(0,o._)("div",v,[(0,o.Wm)(c,{class:"u-upload-icon",onClick:t[1]||(t[1]=t=>e.showUploader=!e.showUploader)},{default:(0,o.w5)((()=>[(0,o.Wm)(l)])),_:1}),(0,o.Wm)(u,{class:"c-comment-emotion",onSelected:r.handleEmotionSelected,type:"pop",max:6},null,8,["onSelected"]),(0,o.Wm)(m,{onReply:r.onQuickReply},null,8,["onReply"]),(0,o._)("div",C,[(0,o.Wm)(h,{class:"u-secret",modelValue:e.is_secret,"onUpdate:modelValue":t[2]||(t[2]=t=>e.is_secret=t),border:"",size:"small"},{default:(0,o.w5)((()=>[(0,o.Uk)("悄悄话 "),(0,o.Wm)(d,{class:"item",effect:"dark",content:"勾选悄悄话后仅作者和你可见，并且不可再变更状态",placement:"top"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(p)])),_:1})])),_:1})])),_:1},8,["modelValue"])])]),e.showUploader?((0,o.wg)(),(0,o.j4)(f,{key:0,class:"u-uploader",ref:"uploader",onOnFinish:r.attachmentUploadFinish,onOnError:r.attachmentUploadError},null,8,["onOnFinish","onOnError"])):(0,o.kq)("",!0),(0,o._)("div",S,[(0,o.Wm)(g,{type:"primary",onClick:r.onSubmit,class:"u-publish",disabled:e.disableSubmitBtn},{default:(0,o.w5)((()=>[(0,o.Uk)("发表评论")])),_:1},8,["onClick","disabled"])])])),_:1})])),_:1},8,["model"])}const j={class:"el-upload__tip"},$=["src"];function R(e,t,n,i,s,r){const a=(0,o.up)("Plus"),l=(0,o.up)("el-icon"),c=(0,o.up)("el-upload"),u=(0,o.up)("el-dialog");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o.Wm)(c,{action:"https://cms.jx3box.com/api/cms/upload",ref:"upload","list-type":"picture-card","on-preview":r.handlePictureCardPreview,"auto-upload":!1,"file-list":s.fileList,limit:s.maxCount,accept:s.acceptedExtensions.reduce(((e,t)=>e+`.${t},`),""),multiple:"","with-credentials":"","on-exceed":r.onExceed,"on-change":r.onChange,"on-success":r.onSuccess,"on-error":r.onError},{tip:(0,o.w5)((()=>[(0,o._)("div",j," 最多上传 "+(0,p.zw)(s.maxCount)+" 张 "+(0,p.zw)(s.acceptedExtensions.join(" / ").toUpperCase())+" 格式图片，单张图片不能超过 "+(0,p.zw)(s.maxSize/1024/1024)+" MB ",1)])),default:(0,o.w5)((()=>[(0,o.Wm)(l,null,{default:(0,o.w5)((()=>[(0,o.Wm)(a)])),_:1})])),_:1},8,["on-preview","file-list","limit","accept","on-exceed","on-change","on-success","on-error"]),(0,o.Wm)(u,{modelValue:s.dialogVisible,"onUpdate:modelValue":t[0]||(t[0]=e=>s.dialogVisible=e)},{default:(0,o.w5)((()=>[(0,o._)("img",{width:"60%",src:s.dialogImageUrl,alt:""},null,8,$)])),_:1},8,["modelValue"])])}var U={name:"CommentUploader",data(){return{dialogImageUrl:"",dialogVisible:!1,fileList:[],successList:[],acceptedExtensions:["jpg","jpeg","png","gif"],maxCount:5,maxSize:2097152}},emits:["onFinish","onError"],methods:{handlePictureCardPreview(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},onExceed(){this.$notify({title:"",message:`最多上传 ${this.maxCount} 张图片！`,type:"error",duration:3e3,position:"bottom-right"})},onChange(e,t){"ready"==e.status&&(e.size>this.maxSize?(this.$notify({title:"",message:`单张图片大小不能超过 ${this.maxSize/1024/1024} MB！`,type:"error",duration:3e3,position:"bottom-right"}),t.pop()):this.fileList=t)},upload(){this.fileList.length>0?this.$refs.upload.submit():this.$emit("onFinish",[])},onSuccess(e){this.successList=this.successList.concat(e.data),this.successList.length==this.fileList.length&&(this.$emit("onFinish",this.successList||[]),this.fileList=[],this.successList=[])},onError(){this.$notify({title:"",message:"图片上传失败!",type:"error",duration:3e3,position:"bottom-right"}),this.$emit("onError"),this.fileList=[]}}};const I=(0,k.Z)(U,[["render",R]]);var P=I,E=n.p+"img/emotion.08adf9c0.svg";const D={class:"c-jx3box-emotion"},T=["onClick"],A=["src","alt","title"],F={class:"c-jx3box-emotion-pop__content"},W=(0,o._)("div",{class:"u-title"},"表情",-1),z=["src","alt","title"],O={class:"c-jx3box-emotion-list"},q=["onClick"],N=["src","alt","title"],B=(0,o._)("img",{slot:"reference",class:"u-reference",width:"24",height:"24",src:E,alt:""},null,-1);function H(e,t,n,i,s,r){const a=(0,o.up)("el-tab-pane"),l=(0,o.up)("el-tabs"),c=(0,o.up)("Close"),u=(0,o.up)("el-icon"),m=(0,o.up)("el-popover");return(0,o.wg)(),(0,o.iD)("div",D,["default"===n.type?((0,o.wg)(),(0,o.j4)(l,{key:0,type:"card"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.decorationEmotion,(e=>((0,o.wg)(),(0,o.j4)(a,{key:e.group_id,label:e.group_name},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.items,(e=>((0,o.wg)(),(0,o.iD)("span",{key:e.emotion_id,class:"c-jx3box-emotion-item",onClick:t=>r.handleEmotionClick(e)},[(0,o._)("img",{src:`${s.EmojiPath}${e.filename}`,alt:e.key,title:e.key},null,8,A)],8,T)))),128))])),_:2},1032,["label"])))),128))])),_:1})):((0,o.wg)(),(0,o.j4)(m,{key:1,placement:"top",trigger:"click","visible-arrow":!1,"popper-class":"c-jx3box-emotion-pop",ref:"emotion"},{reference:(0,o.w5)((()=>[B])),default:(0,o.w5)((()=>[(0,o._)("div",F,[(0,o.Wm)(u,{class:"u-close",onClick:r.closePop},{default:(0,o.w5)((()=>[(0,o.Wm)(c)])),_:1},8,["onClick"]),W,(0,o.Wm)(l,{class:"u-tabs",type:"card","tab-position":"bottom",size:"small"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.decorationEmotion,(e=>((0,o.wg)(),(0,o.j4)(a,{key:e.group_id,label:e.group_name},{label:(0,o.w5)((()=>[(0,o._)("img",{src:`${s.EmojiPath}${e.items[0].filename}`,alt:e.items[0].key,title:e.group_name,class:"u-tab-label"},null,8,z)])),default:(0,o.w5)((()=>[(0,o._)("div",O,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.items,(e=>((0,o.wg)(),(0,o.iD)("span",{key:e.emotion_id,class:"c-jx3box-emotion-item",onClick:t=>r.handleEmotionClick(e)},[(0,o._)("img",{src:`${s.EmojiPath}${e.filename}`,alt:e.key,title:e.key},null,8,N)],8,q)))),128))])])),_:2},1032,["label"])))),128))])),_:1})])])),_:1},512))])}var V=n(58663),M=n(5121);const{__cms:J}=V,Z=e=>{const t=e&&e.domain||J;let n={withCredentials:!0,auth:{username:localStorage&&localStorage.getItem("token")||"",password:"cms common request"},baseURL:t,headers:{}};const o=M.Z.create(n);return o};var Y=n(37007),K=JSON.parse('{"accept":"image/jpeg,image/gif,image/png,image/bmp,text/plain,text/csv,text/jx3dat,text/dat,application/pdf,application/zip,application/rar,application/x-7z-compressed,application/msword,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/octet-stream,text/blueprint,text/blueprintx","ext":["jpg","gif","png","bmp","txt","csv","jx3dat","dat","pdf","zip","rar","7z","doc","docx","xls","xlsx","ttf","blueprint","blueprintx"],"sizeLimit":5242880,"tokenExpires":2592000000}'),Q=n(15442),X=n.n(Q);function G(e){return console.log(e.response),Promise.reject(e)}function ee(e,t){e["interceptors"]["response"].use((function(e){return e.data.code?Promise.reject(e):e}),(function(e){return G(e)}))}function te(e,t){e["interceptors"]["response"].use((function(e){return e.data.code?Promise.reject(e):e}),(function(e){return G(e)}))}function ne(e){let t=e&&e.domain||V.__cms,n={withCredentials:!0,auth:{username:localStorage&&localStorage.getItem("token")||"",password:"cms common request"},baseURL:t,headers:{}};const o=X().create(n);return te(o,e),o}function oe(e){let t=e&&e.domain||V.__next,n={withCredentials:!0,auth:{username:localStorage&&localStorage.getItem("token")||"",password:"next common request"},baseURL:t,headers:{}};const o=X().create(n);return ee(o,e),o}function ie(e){let t=e&&Object.assign(e,{domain:V.__pay})||{domain:V.__pay};return oe(t)}let{__Links:se,default_avatar:re,__server:ae,__userLevel:le}=V,{tokenExpires:ce}=K;class ue{constructor(){this.expires=ce,this.created_at=0,this.logged_in=!1,this.profile={},this.anonymous={uid:0,group:0,name:"未登录",status:0,bind_wx:0,avatar:(0,Y.showAvatar)(null,"s"),avatar_origin:re},this.asset=""}check(){return this.isLogin()?(this.profile.uid=localStorage&&localStorage.getItem("uid"),this.profile.group=localStorage&&localStorage.getItem("group")||1,this.profile.token=localStorage&&localStorage.getItem("token"),this.profile.name=localStorage&&localStorage.getItem("name"),this.profile.status=localStorage&&localStorage.getItem("status"),this.profile.bind_wx=localStorage&&localStorage.getItem("bind_wx"),this.profile.avatar_origin=localStorage&&localStorage.getItem("avatar")||re,this.profile.avatar=(0,Y.showAvatar)(this.profile.avatar_origin,"s")):this.profile=this.anonymous,this}refresh(e,t){return localStorage.setItem(e,t)}isLogin(){return this.created_at=localStorage.getItem("created_at")?localStorage.getItem("created_at"):-1/0,this.logged_in="true"==localStorage.getItem("logged_in"),this.logged_in&&Date.now()-this.created_at<this.expires}_save(e){localStorage.setItem("created_at",Date.now()),localStorage.setItem("logged_in",!0),localStorage.setItem("token",e.token),localStorage.setItem("uid",e.uid),localStorage.setItem("group",e.group),localStorage.setItem("name",e.name),localStorage.setItem("status",e.status),localStorage.setItem("bind_wx",e.bind_wx),localStorage.setItem("avatar",e.avatar)}update(e){return new Promise(((t,n)=>{try{this._save(e),t(this)}catch(o){localStorage?(localStorage.clear(),this._save(e),t(value)):n(new Error("localStorage不可用"))}}))}getInfo(){return this.check(),this.profile}destroy(){return ne({domain:ae}).post("/account/logout").finally((()=>{localStorage.removeItem("created_at"),localStorage.setItem("logged_in","false"),localStorage.removeItem("token")}))}toLogin(e){e=e?encodeURIComponent(e):encodeURIComponent(location.href),location.href=se.account.login+"?redirect="+e}getToken(){return this.getInfo().token}getUUID(){return localStorage.getItem("device_id")}isEmailMember(){return this.getInfo().group>=8}isPhoneMember(){return this.getInfo().group>=16}isEditor(){return this.getInfo().group>=64}isAdmin(){return this.getInfo().group>=128}isDeveloper(){return this.getInfo().group>=256}isSuperAdmin(){return this.getInfo().group>=512}isSuperAuthor(){return this.isLogin()?ne().get("/api/cms/user/is_super_author/"+this.getInfo().uid).then((e=>e.data.data)):new Promise(((e,t)=>{e(!1)}))}hasBindwx(){return this.getInfo().bind_wx}_isVIP(e){let t=e.was_vip;if(t){let t=new Date(e.expire_date)-new Date>0;return t}return!1}_isPRO(e){let t=e.was_pro;if(t){let t=new Date(e.pro_expire_date)-new Date>0;return t}return!1}isVIP(){return this.asset?new Promise(((e,t)=>{e(this._isPRO(this.asset)||this._isVIP(this.asset))})):this.getAsset().then((e=>this._isPRO(e)||this._isVIP(e)))}isPRO(){return this.asset?new Promise(((e,t)=>{e(this._isPRO(this.asset))})):this.getAsset().then((e=>this._isPRO(e)))}getAsset(){return this.isLogin()?ie().get("/api/vip/i").then((e=>{let t=e.data.data;return this.asset=t,t})):new Promise(((e,t)=>{let n={was_vip:0,expire_date:"1970-02-02T16:00:00.000Z",total_day:0,was_pro:0,pro_expire_date:"1970-02-02T16:00:00.000Z",pro_total_day:0,rename_card_count:0,had_renamed:0,namespace_card_count:0,box_coin:0,points:0};this.asset=n,e(n)}))}getLevel(e){for(let t in le){let n=le[t];if(e>=n[0]&&e<n[1])return~~t}}}var me=new ue;const{__imgPath:pe,__dataPath:de}=V;var he={name:"Emotion",props:{type:{type:String,default:"default"},max:{type:Number,default:4}},emits:["selected"],data(){return{emotionList:[],EmojiPath:pe+"emotion/output/",decoration:[]}},created(){this.loadEmotionList(),this.loadDecoration()},computed:{decorationEmotion({emotionList:e,decoration:t}){const n=e.filter((e=>0===e.group_id));if(0===t.length)return n;{const o=e.filter((e=>t.includes(e.group_name)));return[...n,...o].slice(0,this.max)}}},methods:{handleEmotionClick(e){this.$emit("selected",e),this.closePop()},loadEmotionList(){try{const e=sessionStorage.getItem("jx3_emotion");if(e)return void(this.emotionList=JSON.parse(e));fetch(`${de}emotion/output/catalog.json`).then((e=>e.json())).then((e=>{this.emotionList=e,sessionStorage.setItem("jx3_emotion",JSON.stringify(e))}))}catch(e){fetch(`${de}emotion/output/catalog.json`).then((e=>e.json())).then((e=>{this.emotionList=e,sessionStorage.setItem("jx3_emotion",JSON.stringify(e))}))}},loadDecoration(){me.isLogin()&&Z().get("/api/cms/user/decoration",{params:{type:"emotion",using:1}}).then((e=>{this.decoration=e.data?.data?.map((e=>e?.val))}))},closePop(){this.$refs.emotion&&this.$refs.emotion.hide()}}};const fe=(0,k.Z)(he,[["render",H]]);var ge=fe,we=n.p+"img/comment.640748a2.svg";const ye={class:"c-jx3box-reply"},_e={class:"c-jx3box-reply-pop__content"},ke=(0,o._)("div",{class:"u-title"},"快捷回复",-1),be={class:"m-reply-list"},xe=["onClick"],ve=(0,o._)("img",{class:"u-reference",width:"24",height:"24",src:we,alt:"comment"},null,-1);function Ce(e,t,n,i,s,r){const a=(0,o.up)("Close"),l=(0,o.up)("el-icon"),c=(0,o.up)("el-popover");return(0,o.wg)(),(0,o.iD)("div",ye,[(0,o.Wm)(c,{"visible-arrow":!0,placement:"top",ref:"quickReply",trigger:"click","popper-class":"c-jx3box-reply-pop"},{reference:(0,o.w5)((()=>[ve])),default:(0,o.w5)((()=>[(0,o._)("div",_e,[(0,o.Wm)(l,{class:"u-close",onClick:r.closePop},{default:(0,o.w5)((()=>[(0,o.Wm)(a)])),_:1},8,["onClick"]),ke,(0,o._)("div",be,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(s.replyTemplate,((e,t)=>((0,o.wg)(),(0,o.iD)("div",{class:"m-reply-list__item",key:t,onClick:t=>r.reply(e)},(0,p.zw)(e),9,xe)))),128))])])])),_:1},512)])}var Se=JSON.parse('["真不错，谢谢楼主#胜利#笨猪#胜利","辛苦了，感谢楼主的付出","谢谢楼主，很有用","剑三真好玩，魔盒真好用"]'),Le={name:"QuickReply",data(){return{replyTemplate:Se}},emits:["reply"],methods:{closePop(){this.$refs.quickReply&&this.$refs.quickReply.doClose()},reply(e){this.$emit("reply",e),this.closePop()}}};const je=(0,k.Z)(Le,[["render",Ce]]);var $e=je,Re={components:{Uploader:P,Emotion:ge,QuickReply:$e},props:{isBottom:{type:Boolean,default:!1}},mounted(){this.isBottom&&(this.inputId="textarea-bottom")},data:function(){return{showUploader:!1,disableSubmitBtn:!1,newComment:{content:""},inputId:"textarea-top",is_secret:!1}},methods:{onSubmit(){this.disableSubmitBtn=!0,this.$refs.uploader?this.$refs.uploader.upload():this.attachmentUploadFinish([])},onQuickReply(e){this.$emit("submit",{content:e,attachmentList:[],is_template:1})},attachmentUploadFinish(e){this.$emit("submit",{content:this.newComment.content,attachmentList:e}),this.newComment={content:""},this.showUploader=!1,this.disableSubmitBtn=!1},attachmentUploadError(){this.disableSubmitBtn=!1},handleEmotionSelected(e){this.insertVariable(e)},async insertVariable(e){const t=document.querySelector(`#${this.inputId}`),n=e.key;if(t.selectionStart||0===t.selectionStart){let e=t.selectionStart,o=t.selectionEnd;this.newComment.content=t.value.substring(0,e)+n+t.value.substring(o,t.value.length),await this.$nextTick(),t.focus(),t.setSelectionRange(o+n.length,o+n.length)}else this.newComment.content=n}}};const Ue=(0,k.Z)(Re,[["render",L]]);var Ie=Ue;const Pe={class:"c-comment-cmt"},Ee={class:"c-comment-cmt__author"},De={key:0,class:"u-mark u-top"},Te={key:1,class:"u-mark u-star"},Ae={key:2,class:"u-mark u-secret"};function Fe(e,t,n,i,s,r){const a=(0,o.up)("el-link"),l=(0,o.up)("Download"),c=(0,o.up)("el-icon"),u=(0,o.up)("Star"),m=(0,o.up)("Cherry"),d=(0,o.up)("CommentContent"),h=(0,o.up)("ReplyList");return(0,o.wg)(),(0,o.iD)("div",Pe,[(0,o._)("div",Ee,[(0,o.Wm)(a,{class:"u-name",type:"primary",target:"_blank",href:e.userHref},{default:(0,o.w5)((()=>[(0,o.Uk)((0,p.zw)(n.username||"人字榜800线无名小侠"),1)])),_:1},8,["href"]),n.item.is_top?((0,o.wg)(),(0,o.iD)("span",De,[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(l)])),_:1}),(0,o.Uk)("置顶")])):(0,o.kq)("",!0),n.item.is_star?((0,o.wg)(),(0,o.iD)("span",Te,[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(u)])),_:1}),(0,o.Uk)("精华")])):(0,o.kq)("",!0),n.item.is_secret?((0,o.wg)(),(0,o.iD)("span",Ae,[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m)])),_:1}),(0,o.Uk)("悄悄话")])):(0,o.kq)("",!0)]),(0,o.Wm)(d,{date:n.item.commentDate,content:n.item.content,"comment-id":n.item.id,attachments:r.stringToArray(n.item.attachments),"can-delete":n.power.can_del||n.power.uid==n.item.userId,"can-set-top":(n.power.is_author||n.power.is_editor)&&!n.item.is_top,"can-cancel-top":(n.power.is_author||n.power.is_editor)&&n.item.is_top,"can-set-star":!n.item.is_star&&(n.power.is_author||n.power.is_editor),"can-cancel-star":n.item.is_star&&(n.power.is_author||n.power.is_editor),"can-add-white":!n.item.is_white&&1==n.power.article_open_white,"can-remove-white":n.item.is_white&&(1==n.power.is_author||1==n.power.is_editor),"can-hide":1==n.power.is_author||1==n.power.is_editor,"is-like":1==n.item.is_likes,likes:~~n.item.likes,onAddNewReply:r.addNewReply,onDeleteComment:r.deleteComment,onSetTopComment:r.setTopComment,onSetStarComment:r.setStarComment,onSetLikeComment:r.setLikeComment,onSetWhiteComment:r.setWhiteComment,onHide:r.hideComment},null,8,["date","content","comment-id","attachments","can-delete","can-set-top","can-cancel-top","can-set-star","can-cancel-star","can-add-white","can-remove-white","can-hide","is-like","likes","onAddNewReply","onDeleteComment","onSetTopComment","onSetStarComment","onSetLikeComment","onSetWhiteComment","onHide"]),(0,o.Wm)(h,{data:e.replyList,pager:e.pager,power:n.power,onAddNewReply:r.addNewReply,onDeleteReply:r.deleteReply,onGoto:r.gotoReplyListIndex,onResetReply:r.resetReply,onSetLikeComment:r.setLikeReply,onHide:r.hideComment},null,8,["data","pager","power","onAddNewReply","onDeleteReply","onGoto","onResetReply","onSetLikeComment","onHide"])])}var We=n.p+"img/heart_1.555fbe56.svg",ze=n.p+"img/heart_2.f3480d38.svg",Oe=n.p+"img/view.9aea164a.svg",qe=n.p+"img/hide.61750340.svg";const Ne={class:"u-cmt"},Be=["innerHTML"],He={key:1,class:"u-attachements"},Ve={class:"u-toolbar u-toolbar--primary"},Me={class:"u-toolbar-left"},Je=(0,o._)("img",{class:"u-up",src:We,alt:""},null,-1),Ze={class:"u-like-count"},Ye=(0,o._)("img",{class:"u-up",src:ze,alt:""},null,-1),Ke={class:"u-like-count"},Qe={class:"u-date"},Xe=(0,o._)("i",{class:"Clock"},null,-1),Ge={class:"u-toolbar-right"},et=(0,o._)("img",{class:"u-icon-filter",src:Oe,alt:"显示"},null,-1),tt=(0,o._)("img",{class:"u-icon-filter",src:qe,alt:"隐藏"},null,-1),nt={class:"c-comment-tools"};function ot(e,t,n,i,s,r){const a=(0,o.up)("el-image"),l=(0,o.up)("el-button"),c=(0,o.up)("el-input"),u=(0,o.up)("el-form-item"),m=(0,o.up)("Picture"),d=(0,o.up)("el-icon"),h=(0,o.up)("Emotion"),f=(0,o.up)("Uploader"),g=(0,o.up)("el-form");return(0,o.wg)(),(0,o.iD)("div",Ne,[""!=n.content?((0,o.wg)(),(0,o.iD)("div",{key:0,class:"u-text",innerHTML:e.renderContent},null,8,Be)):(0,o.kq)("",!0),n.attachments.length?((0,o.wg)(),(0,o.iD)("div",He,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.attachments,(e=>((0,o.wg)(),(0,o.j4)(a,{key:e,src:r.showAttachment(e),"preview-src-list":[r.showPreview(e)],lazy:""},null,8,["src","preview-src-list"])))),128))])):(0,o.kq)("",!0),(0,o._)("div",Ve,[(0,o._)("div",Me,[e.currentUserHadLike?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(l,{key:0,class:"u-admin",link:"",size:"small",onClick:t[0]||(t[0]=e=>r.doLike(!0))},{default:(0,o.w5)((()=>[Je,(0,o.Uk)("点赞"),(0,o._)("span",Ze,(0,p.zw)(r.likesFormat(e.hasLikeCount)),1)])),_:1})),e.currentUserHadLike?((0,o.wg)(),(0,o.j4)(l,{key:1,class:"u-admin",link:"",size:"small",onClick:t[1]||(t[1]=e=>r.doLike(!1))},{default:(0,o.w5)((()=>[Ye,(0,o.Uk)("已赞"),(0,o._)("span",Ke,(0,p.zw)(r.likesFormat(e.hasLikeCount)),1)])),_:1})):(0,o.kq)("",!0),(0,o.Wm)(l,{class:"u-admin",link:"",size:"small",icon:"ChatRound",onClick:t[2]||(t[2]=t=>e.showForm=!e.showForm),type:"primary"},{default:(0,o.w5)((()=>[(0,o.Uk)("回复")])),_:1}),n.canDelete?((0,o.wg)(),(0,o.j4)(l,{key:2,class:"u-admin",link:"",icon:"Delete",size:"small",onClick:t[3]||(t[3]=e=>r.deleteComment()),type:"danger"},{default:(0,o.w5)((()=>[(0,o.Uk)("删除")])),_:1})):(0,o.kq)("",!0),n.canHide?((0,o.wg)(),(0,o.j4)(l,{key:3,class:"u-admin",link:"",size:"small",icon:"Delete",onClick:t[4]||(t[4]=e=>r.hideComment()),title:"拉入黑洞后，仅评论者自己独自可见"},{default:(0,o.w5)((()=>[(0,o.Uk)("黑洞")])),_:1})):(0,o.kq)("",!0),n.canSetTop?((0,o.wg)(),(0,o.j4)(l,{key:4,class:"u-admin",link:"",icon:"Top",size:"small",onClick:t[5]||(t[5]=e=>r.topComment(!0)),type:"primary"},{default:(0,o.w5)((()=>[(0,o.Uk)("置顶")])),_:1})):(0,o.kq)("",!0),n.canCancelTop?((0,o.wg)(),(0,o.j4)(l,{key:5,class:"u-admin",link:"",icon:"Top",size:"small",onClick:t[6]||(t[6]=e=>r.topComment(!1)),type:"primary"},{default:(0,o.w5)((()=>[(0,o.Uk)("取消置顶")])),_:1})):(0,o.kq)("",!0),n.canSetStar?((0,o.wg)(),(0,o.j4)(l,{key:6,class:"u-admin",link:"",icon:"Star",size:"small",onClick:t[7]||(t[7]=e=>r.starComment(!0)),type:"primary"},{default:(0,o.w5)((()=>[(0,o.Uk)("加精")])),_:1})):(0,o.kq)("",!0),n.canCancelStar?((0,o.wg)(),(0,o.j4)(l,{key:7,class:"u-admin",link:"",icon:"StarFilled",size:"small",onClick:t[8]||(t[8]=e=>r.starComment(!1)),type:"primary"},{default:(0,o.w5)((()=>[(0,o.Uk)("取消加精")])),_:1})):(0,o.kq)("",!0),(0,o._)("time",Qe,[Xe,(0,o.Uk)(" "+(0,p.zw)(r.dataFormat(n.date)),1)])]),(0,o._)("div",Ge,[n.canAddWhite?((0,o.wg)(),(0,o.j4)(l,{key:0,class:"u-admin u-filter",link:"",size:"small",onClick:t[9]||(t[9]=e=>r.setWhiteComment(!0))},{default:(0,o.w5)((()=>[et,(0,o.Uk)(" 显示")])),_:1})):(0,o.kq)("",!0),n.canRemoveWhite?((0,o.wg)(),(0,o.j4)(l,{key:1,class:"u-admin u-filter",link:"",size:"small",onClick:t[10]||(t[10]=e=>r.setWhiteComment(!1))},{default:(0,o.w5)((()=>[tt,(0,o.Uk)("隐藏")])),_:1})):(0,o.kq)("",!0)])]),e.showForm?((0,o.wg)(),(0,o.j4)(g,{key:2,ref:"form",model:e.newComment,class:"c-comment-subbox"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Wm)(c,{type:"textarea",modelValue:e.newComment.content,"onUpdate:modelValue":t[11]||(t[11]=t=>e.newComment.content=t),placeholder:"参与评论...",id:"id"+e.inputId},null,8,["modelValue","id"])])),_:1}),(0,o.Wm)(u,{class:"c-comment-tool-box"},{default:(0,o.w5)((()=>[(0,o._)("div",nt,[(0,o.Wm)(d,{class:"u-upload-icon",onClick:t[12]||(t[12]=t=>e.showUploader=!e.showUploader)},{default:(0,o.w5)((()=>[(0,o.Wm)(m)])),_:1}),(0,o.Wm)(h,{class:"c-comment-emotion",onSelected:r.handleEmotionSelected,type:"pop",max:6},null,8,["onSelected"])]),e.showUploader?((0,o.wg)(),(0,o.j4)(f,{key:0,ref:"uploader",onOnFinish:r.attachmentUploadFinish,onOnError:r.attachmentUplodError},null,8,["onOnFinish","onOnError"])):(0,o.kq)("",!0)])),_:1}),(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Wm)(l,{size:"small",type:"primary",onClick:t[13]||(t[13]=e=>r.submit()),disabled:e.disableSubmitBtn},{default:(0,o.w5)((()=>[(0,o.Uk)("提交")])),_:1},8,["disabled"]),(0,o.Wm)(l,{size:"small",link:"",onClick:t[14]||(t[14]=t=>e.showForm=!1),type:"primary"},{default:(0,o.w5)((()=>[(0,o.Uk)("收起")])),_:1})])),_:1})])),_:1},8,["model"])):(0,o.kq)("",!0)])}var it=n(96486);const{__imgPath:st,__dataPath:rt}=V,at=[],lt=[];let ct=!1;async function ut(){if(lt.length>0)return;if(ct&&0===lt.length)return await new Promise((e=>{at.push(e)}));ct=!0;const e=sessionStorage.getItem("jx3_emotion");if(e)lt.push(...JSON.parse(e));else{const e=await fetch(`${rt}emotion/output/catalog.json`).then((e=>e.json()));lt.push(...e.map((e=>e.items)).reduce(((e,t)=>e.concat(t)),[])),sessionStorage.setItem("jx3_emotion",JSON.stringify(lt))}ct=!1,at.forEach((e=>e()))}class mt{constructor(e){this.joke=String(e).trim()}async _renderHTML(){if(!this.joke.includes("#"))return this.joke;await ut();const e=(0,it.keyBy)(lt,"key");for(const t in e)if(this.joke.includes(t)){const n=`${st}emotion/output/${e[t].filename}`;this.joke=this.joke.replaceAll(t,`<img src="${n}" alt="${t}" title="${t}" />`)}return this.joke}}var pt=mt;function dt(e){return e.replace(/[<>"']/g,(function(e){switch(e){case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;"}}))}async function ht(e){const t=new pt(dt(e));return await t._renderHTML()}function ft(e){return e>9?e:`0${e}`}var gt={props:["content","date","hasReply","canDelete","canSetTop","canCancelTop","canHide","isLike","likes","canSetStar","canCancelStar","attachments","commentId","canAddWhite","canRemoveWhite"],components:{Uploader:P,Emotion:ge},data:function(){return{newComment:{content:""},showForm:!1,disableSubmitBtn:!1,showUploader:!1,inputId:"",previewList:[],currentUserHadLike:this.isLike,hasLikeCount:this.likes,renderContent:""}},mounted(){this.commentId&&(this.inputId=this.commentId)},computed:{_attachments:function(){return this.attachments.map((e=>(0,m.resolveImagePath)(e)))}},watch:{content:{handler:function(e){this.formatContent(e)},immediate:!0}},methods:{doLike(e){e!==this.currentUserHadLike&&(this.currentUserHadLike=e,this.hasLikeCount=e?this.hasLikeCount+1:this.hasLikeCount-1,this.$emit("setLikeComment",e))},topComment(e){this.$emit("setTopComment",e)},starComment(e){this.$emit("setStarComment",e)},setWhiteComment(e){this.$emit("setWhiteComment",e)},deleteComment(){this.$confirm("确定删除该评论吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$emit("deleteComment")})).catch((()=>{}))},hideComment(){this.$confirm("确定隐藏该评论吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$emit("hide",this.commentId)})).catch((()=>{}))},dataFormat(e){let t=new Date(e);return t.getFullYear()+"-"+ft(t.getMonth()+1)+"-"+ft(t.getDate())+" "+ft(t.getHours())+":"+ft(t.getMinutes())+":"+ft(t.getSeconds())},likesFormat(e){return e>0?e:""},attachmentUploadFinish(e){this.disableSubmitBtn=!1,this.$emit("addNewReply",{content:this.newComment.content,attachmentList:e}),this.showUploader=!1,this.newComment={content:""}},attachmentUplodError(){this.disableSubmitBtn=!1},submit(){this.disableSubmitBtn=!0,this.$refs.uploader?this.$refs.uploader.upload():this.attachmentUploadFinish([])},hideForm(){},async formatContent(e){this.renderContent=await ht(e)},async handleEmotionSelected(e){const t=document.querySelector(`#id${this.inputId}`),n=e.key;if(t.selectionStart||0===t.selectionStart){let e=t.selectionStart,o=t.selectionEnd;this.newComment.content=t.value.substring(0,e)+n+t.value.substring(o,t.value.length),await this.$nextTick(),t.focus(),t.setSelectionRange(o+n.length,o+n.length)}else this.newComment.content=n},showPreview:function(e){return(0,m.resolveImagePath)(e)},showAttachment:function(e){return(0,m.resolveImagePath)(e)+"?x-oss-process=style/comment_thumb"}}};const wt=(0,k.Z)(gt,[["render",ot]]);var yt=wt,_t=n(49963);const kt={key:0,class:"c-comment-replylist"};function bt(e,t,n,i,s,r){const a=(0,o.up)("reply-item"),l=(0,o.up)("el-button"),c=(0,o.up)("el-col"),u=(0,o.up)("el-pagination"),m=(0,o.up)("el-row");return n.data.length?((0,o.wg)(),(0,o.iD)("div",kt,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.data,(e=>((0,o.wg)(),(0,o.j4)(a,{class:"c-comment-reply",key:e.id,reply:e,power:n.power,onDeleteReply:r.deleteReply,onAddReply:r.addReply,onSetLikeComment:r.setLikeComment,onHide:r.hideReply},null,8,["reply","power","onDeleteReply","onAddReply","onSetLikeComment","onHide"])))),128)),n.data.length>=3||e.showPager?((0,o.wg)(),(0,o.j4)(m,{key:0},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{span:4},{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)(l,{link:"",onClick:t[0]||(t[0]=e=>r.showLess())},{default:(0,o.w5)((()=>[(0,o.Uk)("收起")])),_:1},512),[[_t.F8,e.showPager]]),(0,o.wy)((0,o.Wm)(l,{link:"",onClick:t[1]||(t[1]=e=>r.showMore())},{default:(0,o.w5)((()=>[(0,o.Uk)("查看更多")])),_:1},512),[[_t.F8,!e.showPager]])])),_:1}),(0,o.Wm)(c,{span:20,class:"c-comment-reply-pages"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)(u,{small:"",onCurrentChange:r.handleCurrentChange,"current-page":n.pager.index,"page-size":n.pager.pageSize,layout:"total, prev, pager, next",total:n.pager.total},null,8,["onCurrentChange","current-page","page-size","total"]),[[_t.F8,e.showPager]])])),_:1})])),_:1})):(0,o.kq)("",!0)])):(0,o.kq)("",!0)}function xt(e,t,n,i,s,r){const a=(0,o.up)("CommentAvatar"),l=(0,o.up)("CommentContentSimple"),c=(0,o.up)("ReplyForReply"),u=(0,o.up)("el-row");return(0,o.wg)(),(0,o.j4)(u,null,{default:(0,o.w5)((()=>[(0,o.Wm)(a,{"user-avatar":r.showAvatar(n.reply.avatar),"user-href":r.profileLink(n.reply.userId),username:n.reply.displayName,avatarFrame:n.reply.user_avatar_frame,avatarSize:36},null,8,["user-avatar","user-href","username","avatarFrame"]),(0,o.Wm)(l,{"comment-id":n.reply.id,date:n.reply.commentDate,content:n.reply.content,attachments:r.stringToArray(n.reply.attachments),"can-delete":n.power.can_del||n.power.uid==n.reply.userId,"can-hide":1==n.power.is_author||1==n.power.is_editor,"can-reply":n.power.uid!=n.reply.userId,"user-href":r.profileLink(n.reply.replyForUID),"reply-for-username":n.reply.replyForUsername,"reply-for-user-id":n.reply.replyForUID,"is-like":1==n.reply.is_likes,likes:~~n.reply.likes,onDelete:r.deleteReply,onShowReplyInput:t[0]||(t[0]=t=>e.showReplyForReplyFrom=!e.showReplyForReplyFrom),onSetLikeComment:r.setLikeComment,onHide:r.hideReply},null,8,["comment-id","date","content","attachments","can-delete","can-hide","can-reply","user-href","reply-for-username","reply-for-user-id","is-like","likes","onDelete","onSetLikeComment","onHide"]),e.showReplyForReplyFrom?((0,o.wg)(),(0,o.j4)(c,{key:0,username:n.reply.displayName,"user-href":r.profileLink(n.reply.userId),"current-id":n.reply.id,onHideForm:t[1]||(t[1]=t=>e.showReplyForReplyFrom=!1),onDoReply:r.doReply},null,8,["username","user-href","current-id","onDoReply"])):(0,o.kq)("",!0)])),_:1})}const vt={class:"u-reply"},Ct={class:"u-reply-content"},St={key:0,class:"u-reply-label"},Lt=["innerHTML"],jt={key:0,class:"u-attachements"},$t={class:"u-toolbar"},Rt=(0,o._)("img",{class:"u-up",src:We,alt:""},null,-1),Ut={class:"u-like-count"},It=(0,o._)("img",{class:"u-up",src:ze,alt:""},null,-1),Pt={class:"u-like-count"},Et={class:"u-date"},Dt=(0,o._)("i",{class:"Clock"},null,-1);function Tt(e,t,n,i,s,r){const a=(0,o.up)("el-link"),l=(0,o.up)("el-image"),c=(0,o.up)("el-button");return(0,o.wg)(),(0,o.iD)("div",vt,[(0,o._)("div",Ct,[0!=n.replyForUserId?((0,o.wg)(),(0,o.iD)("span",St,[(0,o.Uk)(" 回复 "),(0,o.Wm)(a,{type:"primary",target:"_blank",href:n.userHref},{default:(0,o.w5)((()=>[(0,o.Uk)("@"+(0,p.zw)(n.replyForUsername),1)])),_:1},8,["href"]),(0,o.Uk)(" : ")])):(0,o.kq)("",!0),(0,o._)("div",{class:"u-reply-text",innerHTML:e.renderContent},null,8,Lt)]),n.attachments.length?((0,o.wg)(),(0,o.iD)("div",jt,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.attachments,(e=>((0,o.wg)(),(0,o.j4)(l,{key:e,src:r.showAttachment(e),"preview-src-list":[r.showPreview(e)],lazy:""},null,8,["src","preview-src-list"])))),128))])):(0,o.kq)("",!0),(0,o._)("div",$t,[e.currentUserHadLike?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(c,{key:0,class:"u-admin",link:"",size:"small",onClick:t[0]||(t[0]=e=>r.doLike(!0))},{default:(0,o.w5)((()=>[Rt,(0,o.Uk)("点赞"),(0,o._)("span",Ut,(0,p.zw)(r.likesFormat(e.hasLikeCount)),1)])),_:1})),e.currentUserHadLike?((0,o.wg)(),(0,o.j4)(c,{key:1,class:"u-admin",link:"",size:"small",onClick:t[1]||(t[1]=e=>r.doLike(!1))},{default:(0,o.w5)((()=>[It,(0,o.Uk)("已赞"),(0,o._)("span",Pt,(0,p.zw)(r.likesFormat(e.hasLikeCount)),1)])),_:1})):(0,o.kq)("",!0),n.canReply?((0,o.wg)(),(0,o.j4)(c,{key:2,class:"u-admin",link:"",icon:"ChatLineRound",size:"small",onClick:r.showReplyForReplyInput,type:"primary"},{default:(0,o.w5)((()=>[(0,o.Uk)("回复")])),_:1},8,["onClick"])):(0,o.kq)("",!0),n.canDelete?((0,o.wg)(),(0,o.j4)(c,{key:3,class:"u-admin",link:"",icon:"Delete",size:"small",type:"danger",onClick:r.deleteComment},{default:(0,o.w5)((()=>[(0,o.Uk)("删除")])),_:1},8,["onClick"])):(0,o.kq)("",!0),n.canHide?((0,o.wg)(),(0,o.j4)(c,{key:4,class:"u-admin",link:"",size:"small",icon:"Delete",onClick:r.hideComment,title:"拉入黑洞后，仅评论者自己独自可见"},{default:(0,o.w5)((()=>[(0,o.Uk)(" 黑洞")])),_:1},8,["onClick"])):(0,o.kq)("",!0),(0,o._)("time",Et,[Dt,(0,o.Uk)(" "+(0,p.zw)(r.dataFormat(n.date)),1)])])])}function At(e){return e>9?e:`0${e}`}var Ft={props:["commentId","content","attachments","date","hasReply","canDelete","canHide","canReply","isLike","likes","userHref","replyForUsername","replyForUserId"],data:function(){return{showInput:!1,currentUserHadLike:this.isLike,hasLikeCount:this.likes,renderContent:""}},computed:{_attachments:function(){return this.attachments.map((e=>(0,m.resolveImagePath)(e)))}},watch:{content:{handler:function(e){this.formatContent(e)},immediate:!0}},methods:{profileLink:function(e){return(0,m.authorLink)(e)},showAttachment:function(e){return(0,m.resolveImagePath)(e)+"?x-oss-process=style/comment_thumb"},async formatContent(e){this.renderContent=await ht(e)},getPList(e){return e.split("\n")},doLike(e){e!==this.currentUserHadLike&&(this.currentUserHadLike=e,this.hasLikeCount=e?this.hasLikeCount+1:this.hasLikeCount-1,this.$emit("setLikeComment",e))},deleteComment(){this.$confirm("确定删除该评论吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$emit("delete",this.commentId)})).catch((()=>{}))},hideComment(){this.$confirm("确定隐藏该评论吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$emit("hide",this.commentId)})).catch((()=>{}))},likesFormat(e){return e>0?e:""},dataFormat(e){let t=new Date(e);return t.getFullYear()+"-"+At(t.getMonth()+1)+"-"+At(t.getDate())+" "+At(t.getHours())+":"+At(t.getMinutes())+":"+At(t.getSeconds())},showReplyForReplyInput(){this.$emit("showReplyInput")},previewImg(e){this.$hevueImgPreview({multiple:!0,nowImgIndex:e,imgList:this._attachments,controlBar:!1,clickMaskCLose:!0})},showPreview:function(e){return(0,m.resolveImagePath)(e)}}};const Wt=(0,k.Z)(Ft,[["render",Tt]]);var zt=Wt;const Ot={class:"u-subbox-label"},qt={class:"c-comment-tools"};function Nt(e,t,n,i,s,r){const a=(0,o.up)("el-link"),l=(0,o.up)("el-input"),c=(0,o.up)("el-form-item"),u=(0,o.up)("Picture"),m=(0,o.up)("el-icon"),d=(0,o.up)("Emotion"),h=(0,o.up)("Uploader"),f=(0,o.up)("el-button"),g=(0,o.up)("el-form");return(0,o.wg)(),(0,o.j4)(g,{ref:"form",class:"c-comment-subbox"},{default:(0,o.w5)((()=>[(0,o._)("div",Ot,[(0,o.Uk)(" 回复 "),(0,o.Wm)(a,{type:"primary",target:"_blank",href:n.userHref},{default:(0,o.w5)((()=>[(0,o.Uk)("＠"+(0,p.zw)(n.username),1)])),_:1},8,["href"]),(0,o.Uk)(" ： ")]),(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(l,{type:"textarea",modelValue:e.content,"onUpdate:modelValue":t[0]||(t[0]=t=>e.content=t),id:"id"+e.inputId,placeholder:"输入回复..."},null,8,["modelValue","id"])])),_:1}),(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o._)("div",qt,[(0,o.Wm)(m,{class:"u-upload-icon",onClick:t[1]||(t[1]=t=>e.showUploader=!e.showUploader)},{default:(0,o.w5)((()=>[(0,o.Wm)(u)])),_:1}),(0,o.Wm)(d,{class:"c-comment-emotion",onSelected:r.handleEmotionSelected,type:"pop",max:6},null,8,["onSelected"])]),e.showUploader?((0,o.wg)(),(0,o.j4)(h,{key:0,ref:"uploader",onOnFinish:r.attachmentUploadFinish,onOnError:r.attachmentUploadError},null,8,["onOnFinish","onOnError"])):(0,o.kq)("",!0)])),_:1}),(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(f,{size:"small",type:"primary",onClick:r.submitReply,disabled:e.disableSubmitBtn},{default:(0,o.w5)((()=>[(0,o.Uk)("提交")])),_:1},8,["onClick","disabled"]),(0,o.Wm)(f,{size:"small",link:"",onClick:t[2]||(t[2]=e=>r.hideForm())},{default:(0,o.w5)((()=>[(0,o.Uk)("收起")])),_:1})])),_:1})])),_:1},512)}var Bt={props:["username","userHref","currentId"],data:function(){return{content:"",showUploader:!1,disableSubmitBtn:!1,inputId:""}},components:{Uploader:P,Emotion:ge},mounted(){this.currentId&&(this.inputId=this.currentId)},methods:{submitReply(){this.disableSubmitBtn=!0,this.$refs.uploader?this.$refs.uploader.upload():this.attachmentUploadFinish([])},hideForm(){this.$emit("hideForm")},attachmentUploadFinish(e){this.disableSubmitBtn=!1,this.$emit("doReply",{content:this.content,attachmentList:e}),this.content="",this.showUploader=!1},attachmentUploadError(){this.disableSubmitBtn=!1},async handleEmotionSelected(e){const t=document.querySelector(`#id${this.inputId}`),n=e.key;if(t.selectionStart||0===t.selectionStart){let e=t.selectionStart,o=t.selectionEnd;this.content=t.value.substring(0,e)+n+t.value.substring(o,t.value.length),await this.$nextTick(),t.focus(),t.setSelectionRange(o+n.length,o+n.length)}else this.content=n}}};const Ht=(0,k.Z)(Bt,[["render",Nt]]);var Vt=Ht,Mt={props:["reply","power"],components:{CommentAvatar:x,CommentContentSimple:zt,ReplyForReply:Vt},backReplyList:[],data:function(){return{showReplyForReplyFrom:!1}},methods:{profileLink:function(e){return(0,m.authorLink)(e)},stringToArray:function(e){return e?JSON.parse(e):[]},showAvatar:function(e){return(0,m.showAvatar)(e,84)},deleteReply(e){this.$emit("deleteReply",e)},hideReply(e){this.$emit("hide",e)},setLikeComment(e){this.$emit("setLikeComment",this.reply.id,e)},doReply(e){e.replyForUID=this.reply.userId,e.replyForCommentId=this.reply.id,this.$emit("addReply",e),this.showReplyForReplyFrom=!1}}};const Jt=(0,k.Z)(Mt,[["render",xt]]);var Zt=Jt,Yt={props:["data","power","pager"],components:{ReplyItem:Zt},data:function(){return{showPager:!1}},emits:["goto","resetReply","deleteReply","addNewReply","setLikeComment","hide"],methods:{showMore(){this.showPager=!0,this.$emit("goto",1)},showLess(){this.showPager=!1,this.$emit("resetReply")},handleCurrentChange(e){this.$emit("goto",e)},deleteReply(e){this.$emit("deleteReply",e)},hideReply(e){this.$emit("hide",e)},setLikeComment(e,t){this.$emit("setLikeComment",e,t)},addReply(e){this.$emit("addNewReply",e)}}};const Kt=(0,k.Z)(Yt,[["render",bt]]);var Qt=Kt,Xt=n(49996),Gt=n(18371),en=n(49e3);const tn="cmt_order",{__Links:nn,__next:on}=w;async function sn(){return en.Z.isLogin()?(0,Gt.nj)({mute:!0}).get("/api/cms/user/conf",{params:{key:tn}}).then((e=>e.data.data)):new Promise((e=>{const t=localStorage.getItem(tn)||"DESC";e(t)}))}async function rn(e){return en.Z.isLogin()?(0,Gt.nj)().put("/api/cms/user/conf",{val:e},{params:{key:tn}}).then((e=>e.data.data)):new Promise((t=>{t(localStorage.setItem(tn,e))}))}const an=function(e,t){let n={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}};return pn(e,t,n)},ln={},cn=function(e,t,n){if(ln[e])if(Date.now()-ln[e].lastest<6e4){if(ln[e].count>=6)return Xt.bM.warning({title:"系统",message:"你单身多久了? 动作这么快, 系统处理不过来 ( T_T )",duration:3e3,position:"bottom-right"}),new Promise(((e,t)=>{t()}));ln[e].count=ln[e].count+1}else Date.now()-ln[e].lastest>6e4&&(ln[e]={lastest:Date.now(),count:0});else ln[e]={lastest:Date.now(),count:0};let o={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)};return pn(e,t,o)},un=function(e,t,n){let o={method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)};return pn(e,t,o)},mn=function(e,t){let n={method:"DELETE"};return pn(e,t,n)};function pn(e,t,n){let o=on;if("/"==o[o.length-1]&&(o=o.substring(0,o.length-1)),e=o+e,n.credentials="include",t){let n=[];Object.keys(t).forEach((e=>{n.push(e+"="+t[e])}));let o=on;"/"==o[o.length-1]&&(o=o.substring(0,o.length-1)),e=e+"?"+n.join("&")}return fetch(e,n).then((e=>{switch(e.status){case 200:break;case 401:throw window.location.href=nn.account.login+"?redirect="+encodeURIComponent(window.location.href),new Error("错误:"+e.statusText);case 403:throw window.location.href=nn.account.login+"?redirect="+encodeURIComponent(window.location.href),new Error("错误:"+e.statusText);case 423:throw window.location.href=nn.account.email_verify+"?redirect="+encodeURIComponent(window.location.href),new Error("错误:"+e.statusText);case 406:throw e.text().then((e=>{Xt.bM.warning({title:"系统",message:e||"提交内容不合法,请重新提交",duration:3e3,position:"bottom-right"})})),new Error("错误:"+e.statusText);default:throw e.text().then((t=>{Xt.bM.error({title:"系统:"+e.statusText,message:t||"系统错误,请稍后重试!",duration:3e3,position:"bottom-right"})})),new Error("错误:"+e.statusText)}let t=e.headers.get("Content-Type");switch(t=t&&t.split(";").shift(),t){case"application/json":return e.json();default:return e.text()}}))}var dn={props:["item","baseApi","power","user-href","username"],components:{CommentContent:yt,ReplyList:Qt},emits:["deleteComment","setTopComment","setStarComment","addNewReply","deleteReply","goto","resetReply"],data:function(){return{replyList:[],pager:{index:1,pageSize:10,pageTotal:1,total:0}}},created(){this.replyList=this.item.reply||[]},methods:{stringToArray:function(e){return e?JSON.parse(e):[]},deleteComment(){this.$emit("deleteComment",this.item.id)},hideComment(){this.$emit("hide",this.item.id)},setTopComment(e){this.$emit("setTopComment",this.item.id,e)},setStarComment(e){this.$emit("setStarComment",this.item.id,e)},setLikeComment(e){this.$emit("setLikeComment",this.item.id,e)},setLikeReply(e,t){this.$emit("setLikeComment",e,t)},setWhiteComment(e){this.$emit("setWhiteComment",this.item.id,e)},addNewReply(e){cn(`${this.baseApi}/comment/${this.item.id}/reply`,null,e).then((()=>{this.$notify({title:"",message:"评论成功!",type:"success",duration:3e3,position:"bottom-right"}),this.loadReplyList(this.pager.index)})).catch((()=>{}))},deleteReply(e){mn(`${this.baseApi}/comment/${e}`).then((()=>{this.$notify({title:"",message:"删除成功!",type:"success",duration:3e3,position:"bottom-right"}),this.loadReplyList(this.pager.index)})).catch((()=>{}))},gotoReplyListIndex(e){this.loadReplyList(e,6)},loadReplyList(e,t){an(`${this.baseApi}/comment/${this.item.id}/reply/page/${e}?pageSize=${t}`).then((n=>{1==e&&3==t&&(this.item.reply=n.data||[]),this.replyList=n.data||[],this.pager=n.page})).catch((()=>{}))},resetReply(){this.loadReplyList(1,3)}}};const hn=(0,k.Z)(dn,[["render",Fe]]);var fn=hn,gn={name:"CommentComp",props:["id","category","normal","order"],components:{CommentAvatar:x,CommentWithReply:fn,CommentInputForm:Ie},data:function(){return{baseAPI:"",commentPower:{allow:!1,uid:-1},commentList:[],pager:{index:1,pageSize:10,pageTotal:1,total:0},isDesc:"DESC",orderByLikes:!1,openWhiteList:!1,loading:!1}},computed:{isNormal:function(){return void 0===this.normal||this.normal}},methods:{changeOrder(){this.reloadCommentList(this.pager.index),rn(this.isDesc?"DESC":"ASC")},changeOrderByLikes(){this.reloadCommentList(this.pager.index)},setTopComment(e,t){const n=t?"set":"cancel";un(`${this.baseAPI}/comment/${e}/top/${n}`).then((()=>{this.reloadCommentList(this.pager.index)})).catch((()=>{}))},changeWhiteList(){un(`${this.baseAPI}/meta/white-list/${this.openWhiteList?"open":"close"}`).then((()=>this.reloadPower())).then((()=>{this.commentPower.is_white=this.openWhiteList,this.reloadCommentList(this.pager.index)})).catch((()=>{}))},setLikeComment(e,t){var n=t?"like":"unlike";un(`${this.baseAPI}/comment/${e}/${n}`).then((()=>{})).catch((()=>{}))},setStarComment(e,t){const n=t?"set":"cancel";un(`${this.baseAPI}/comment/${e}/star/${n}`).then((()=>{this.reloadCommentList(this.pager.index)})).catch((()=>{}))},setWhiteComment(e,t){var n=t?"add":"remove";un(`${this.baseAPI}/comment/${e}/white-list/${n}`).then((()=>{this.reloadCommentList(this.pager.index)})).catch((()=>{}))},deleteComment(e){mn(`${this.baseAPI}/comment/${e}`).then((()=>{this.$notify({title:"",message:"删除成功!",type:"success",duration:3e3,position:"bottom-right"}),this.reloadCommentList(this.pager.index)})).catch((()=>{}))},hideComment(e){un(`${this.baseAPI}/comment/${e}/hide`).then((()=>{this.$notify({title:"",message:"操作成功!",type:"success",duration:3e3,position:"bottom-right"}),this.reloadCommentList(this.pager.index)})).catch((()=>{}))},reloadCommentList(e){this.loading=!0;let t={};"DESC"===this.isDesc&&(t["desc"]=!0),t["orderby_likes"]=this.orderByLikes,an(`${this.baseAPI}/comment/page/${e}`,t).then((e=>{this.commentList=e.data||[],this.pager=e.page})).catch((()=>{})).finally((()=>{this.loading=!1}))},handleCurrentChange(e){this.reloadCommentList(e)},userSubmitInputForm(e){cn(`${this.baseAPI}/comment`,null,e).then((e=>{e&&~~e.code>0?this.$notify({title:"评论失败",message:e.msg||"",type:"error",duration:3e3,position:"bottom-right"}):(this.$notify({title:"",message:"评论成功!",type:"success",duration:3e3,position:"bottom-right"}),1==this.pager.index&&this.reloadCommentList(this.pager.index))})).catch((()=>{}))},profileLink:function(e){return(0,m.authorLink)(e)},showAvatar:function(e){return(0,m.showAvatar)(e,144)},reloadPower(){an(`${this.baseAPI}/i-am-author`).then((e=>{this.commentPower=e,this.openWhiteList=e.is_white})).catch((()=>{}))}},created(){this.baseAPI=`/api/next2/comment/${this.category}/article/${this.id}`},mounted(){sn().then((e=>{this.isDesc=e})).then((()=>{an(`${this.baseAPI}/i-am-author`).then((e=>{this.commentPower=e})).catch((()=>{}))})).finally((()=>{this.reloadCommentList(1)}))}};const wn=(0,k.Z)(gn,[["render",u]]);var yn=wn},58663:function(e){"use strict";e.exports=JSON.parse('{"__Domain":"www.jx3box.com","__Origin":"origin.jx3box.com","__Root":"https://www.jx3box.com/","__OriginRoot":"https://origin.jx3box.com/","__Github":"https://github.jx3box.com/","__server":"https://server.jx3box.com/","__sso":"https://sso.jx3box.com/","__cms":"https://cms.jx3box.com/","__node":"https://node.jx3box.com/","__spider":"https://spider.jx3box.com/","__spider2":"https://spider2.jx3box.com/","__next":"https://next2.jx3box.com/","__pay":"https://pay.jx3box.com/","__team":"https://team.api.jx3box.com/","__lua":"https://lua.jx3box.com/","__down":"https://down.jx3box.com/","__dbm":"https://dbm.jx3box.com/","__helperUrl":"https://helper.jx3box.com/","__os":"https://os.jx3box.com/","__jx3":"https://xn--3-4g8a959k.com/","__cdn":"https://cdn.jx3box.com/","__ossRoot":"https://oss.jx3box.com/","__ossMirror":"https://cdn.jx3box.com/","__staticPath":{"origin":"https://oss.jx3box.com/static/","github":"https://jx3box.github.io/","jsdelivr":"https://cdn.jsdelivr.net/gh/JX3BOX/","mirror":"https://cdn.jx3box.com/static/"},"__dataPath":"https://data.jx3box.com/","__imgPath":"https://img.jx3box.com/","__iconPath":"https://icon.jx3box.com/","__clients":{"std":"重制","origin":"缘起","all":"双端"},"__postType":{"macro":"宏库","bps":"职业","pvp":"竞技","fb":"副本","tool":"工具","bbs":"茶馆","notice":"公告","jx3dat":"插件"},"__wikiType":{"achievement":"成就","item":"物品","knowledge":"通识","quest":"任务"},"__appType":{"face":"捏脸","pz":"配装","joke":"骚话","emotion":"表情","collection":"小册","item_plan":"清单","question":"题目","paper":"试卷","calendar":"日历","battle":"战斗"},"__gameType":{"pet":"宠物","adventure":"奇遇","furniture":"家具","horse":"坐骑","book":"书籍","exterior":"外观","reputation":"声望"},"__sourceType":{"cms_types":["macro","jx3dat","fb","bps","tool","bbs","notice","house","share","joke","emotion","feedback","collection","face"],"pvx_types":["pet","adventure","furniture","horse","book","exterior","reputation"],"wiki_types":["cj","achievement","item","item_plan","wiki","knowledge","quest"],"app_types":["pz","calendar","battle"],"exam_types":["question","paper"],"db_types":["skill","buff","npc","doodad"],"dbm_types":["vpk"],"team_types":["org","role","raid","apply"],"vip_types":["mall"]},"__visibleMap":{"0":"公开","1":"仅自己可见","2":"仅亲友可见","3":"密码可见","4":"付费可见","5":"粉丝可见"},"__userGroup":{"0":"游客","1":"待验证用户","8":"邮箱验证用户","16":"手机验证用户","32":"特约签约作者","64":"编辑","128":"管理员","256":"开发组","512":"超级管理"},"__userLevel":{"1":[0,600],"2":[600,900],"3":[900,1800],"4":[1800,3600],"5":[3600,7200],"6":[7200,999999]},"__userLevelColor":{"1":"#32d3c4","2":"#86c0fb","3":"#33d9ff","4":"#ffdb2a","5":"#ffa739","6":"#ff70b2","7":"#ff3399","8":"#f93c3c"},"__Links":{"account":{"login":"/account/login","register":"/account/register","email_verify":"/account/email_verify","login_callback":"/account/login_callback"},"dashboard":{"home":"/dashboard","msg":"/dashboard/msg","feed":"/dashboard/feed","fav":"/dashboard/fav","profile":"/dashboard/profile","connect":"/dashboard/connect","work":"/publish","publish":"/publish"}},"default_avatar":"https://cdn.jx3box.com/image/common/avatar.png","feedback":"https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=o8LHzsrN48nbkMHM243AzM4"}')},5157:function(e){"use strict";e.exports=JSON.parse('{"douyu":"https://www.douyu.com/","bilibili":"https://live.bilibili.com/","huya":"https://www.huya.com/"}')}}]);
//# sourceMappingURL=863.c1f1f773.js.map